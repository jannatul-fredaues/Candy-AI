<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Listening</title>

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: "Segoe UI", Arial, sans-serif;
}

body {
    height: 100vh;
    background: radial-gradient(circle at top, #0f2348, #08152e);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    overflow: hidden;
}

/* TEXT */
.listening-text {
    color: #7fd3ff;
    font-size: 42px;
    margin-bottom: 50px;
    text-shadow: 0 0 18px rgba(127,211,255,0.9);
}

/* WAVE */
svg {
    width: 100%;
    max-width: 1200px;
    height: 160px;
}

.wave {
    fill: none;
    stroke-width: 8;
    stroke-linecap: round;
    filter: drop-shadow(0 0 18px rgba(127,211,255,0.8));
}
</style>
</head>

<body>

<div class="listening-text">Listening...</div>

<svg viewBox="0 0 1200 160">
    <defs>
        <linearGradient id="waveGradient" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stop-color="#ff4f9a"/>
            <stop offset="40%" stop-color="#ff7ad9"/>
            <stop offset="55%" stop-color="#5cffb0"/>
            <stop offset="75%" stop-color="#4de1ff"/>
            <stop offset="100%" stop-color="#4f6bff"/>
        </linearGradient>
    </defs>

    <path
        id="wavePath"
        class="wave"
        stroke="url(#waveGradient)"
        d="M0 80 Q300 80 600 80 T1200 80"
    />
</svg>

<script>
let audioCtx, analyser, dataArray;
let usingMic = false;
const wave = document.getElementById("wavePath");

/* Try microphone â€“ fallback to idle animation */
navigator.mediaDevices.getUserMedia({ audio: true })
.then(stream => {
    usingMic = true;
    audioCtx = new AudioContext();
    const source = audioCtx.createMediaStreamSource(stream);
    analyser = audioCtx.createAnalyser();
    analyser.fftSize = 256;
    dataArray = new Uint8Array(analyser.frequencyBinCount);
    source.connect(analyser);
    animateMic();
})
.catch(() => {
    idleWave();
});

/* MIC-REACTIVE */
function animateMic() {
    analyser.getByteFrequencyData(dataArray);
    const avg = dataArray.reduce((a,b)=>a+b,0)/dataArray.length;
    const amp = 25 + avg * 0.9;

    wave.setAttribute(
        "d",
        `M0 80
         Q300 ${80-amp} 600 80
         T1200 80`
    );

    requestAnimationFrame(animateMic);
}

/* IDLE ANIMATION (NO MIC) */
let t = 0;
function idleWave() {
    t += 0.03;
    const amp = 20 + Math.sin(t) * 25;

    wave.setAttribute(
        "d",
        `M0 80
         Q300 ${80-amp} 600 80
         T1200 80`
    );

    requestAnimationFrame(idleWave);
}
</script>

</body>
</html>
